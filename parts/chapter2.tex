\chapter{Теоретические исследования}
\label{chapter2}

В данной главе рассматриваются теоретические аспекты разработки фреймворка. Проводится исследование существующих систем, описываются требования к разрабатываемой системе.

\section{JUnit}

Рассмотрим более подробно тестовый фреймворк JUnit. Данный фреймворк впервые показал, как надо устраивать процесс тестирования (на самом деле, основные идеи были сформированы Кент Беком при разработке SUnit, но именно в лице JUnit эти идеи получили широкое распространение)~\cite{xunit_test_patterns}:

\begin{itemize}
\item тесты представляют из себя набор проверок утверждений;
\item тесты могут быть сгруппированы в суиты, для совместного запуска;
\item у каждого теста или суита может быть подготовка (set up) или завершение (tear down);
\item суиты объеденяются в тест ран.
\end{itemize}

Ниже можно посмотреть пример простейщего JUnit теста.

\begin{lstlisting}[caption=Простой JUnit тест.]
public class SampleTest {

    @Testфреймворк
    public void sampleTest() throws Exception {
        assertThat(4, is(2 + 2));
    }
}
\end{lstlisting}

Для семейства xUnit существует стандартный отчет Surefire~\cite{surefire_home}. Есть несколько разных видов этого отчета, но суть у всех одна: отображается список всех тестов, у каждого теста есть статус, время выполнения и сообщение об об ошибке (в случае, если тест не прошел). 

Основным недостатком xUnit является атомарность теста, невозможность отобразить тестовый сценарий. Основаный на JUnit тестовый фреймворк Thucydides~\cite{thucydides_home} решает эту проблему путем разбиения тестов на шаги.

\section{Thucydides}

Thucydides --- это фреймворк для написание тестов на веб-интерфейс с использованием webDriver, написанный Джоном Смартом (John Ferguson Smart). Джон Смарт --- специалист в BDD, в оптимизации жизненного цикла процесса разработки. Хорошо известеный спикер множества интернациональных конференций, автор множества статей~\cite{john_smart_home}.

В свое время данный фреймворк произвел революцию. Прежде всего, фреймворк предлагает структуру для тестов на веб-интерфейс, концепцию разбиения тестов на шаги и возможность сохранять скриншоты каждого шага. Шагом теста являлся любой метод, проаннотированный аннотацией @Step.
Фреймворк анализирует структуру данных методов и отображает информацию о них в отчете. Мало того, это помогало сильно сократить код тестов --- появляется возможность вынести шаги в отдельные библиотеки и переиспользовались в множестве проектов~\cite{thucydides_docs}.

Отчет, который строит Thucydides для тестов, могли посмотреть другие люди, и понять, что происходит в тесте. В Яндексе это позволило разделить тестировщиков на "автоматизаторов" и ответственных за релиз. Первые писали тесты, а вторые эти тесты запускали, просматривали результаты и, в случае необходимости, дополнительно проводили ручное тестирование продукта. Это позволило сильно увеличить качество тестирования за счет появления дополнительного уровня контроля тестировщиков.

Еще одной важной возможностью Thucydides является сохранение скриншотов. В тестах на веб-интерфейс очень важно иметь возможно увидеть, в чем проблема. Однако, не всегда хватает возможности сохранения только скриншотов. Хотелось бы уметь приклеплять к отчету и другие типы данных, например, логи.

Не обошлось в данном фреймворке без недостатков. Прежде всего, предложеная структура слишком ограничивает возможности тестирования. С использованием Thucydides можно писать тесты на веб-интерфейс, а это лишь малая часть функционального тестирования. Для тестов, например, на API данный фреймворк не подходит.

Также важным недостатком является ограничение в используемых технологиях: тесты можно писать используя только тестовый фреймворк JUnit и только систему сборки Maven, не смотря на то, что  в любой большой компании тесты пишутся на разных языках программирования, в зависимости от специфики поставленной задачи.  

Кроме того, Thucydides предлагает очень много возможностей, из-за он чего уже давно превратился в большой, сложный фреймворк с множеством ошибок и проблем. Более правильным решением было бы сделать модульный проект, с возможностью подмены некоторых компонент.

\subsection{Итого} 

Thucydides имеет следующие плюсы: 
\begin{itemize}
\item задается единая структура тестов;
\item разбиение тестов на шаги, отображение сценариев тестов;
\item сохранение скриншотов;
\item хороший отчет, с возможностью группировки тестов по требованиям.
\end{itemize}

Но минусов тоже много:
\begin{itemize}
\item слишком много ограничений, заданных структурой тестов;
\item слишком много ограничений на структуру шагов;
\item невозможность использовать другие типы аттачментов;
\item большое количество проблем и ошибок;
\item отчет понятен только тестировщикам.
\end{itemize}

Вывод: отличный фреймворк, если речь идет только о простом тестировании веб-интерфейсов с использованием JUnit и Maven. В иных случаях не подходит.

\section{Уточненные требования к работе}

Основываясь на анализе существующих решений, были выработаны уточненные требования к фреймворку Allure:

\begin{itemize}
\item умение оперировать как в терминах xUnit, так и в терминах BDD;
\item отображение сценария теста, разбиение теста на шаги;
\item возможность приклеплять к результатам теста произвольные данные;
\item независимость от стека используемых технологий;
\item простой и понятный отчет, который смогут смотреть не только разработчики тестов.
\end{itemize}

В следующей главе рассказывается о процессе разработки фреймворка, удовлетворяющего данным требованиям, и о проблемах, с которыми пришлось столкнуться автору данной работы в процессе разработки. Также описывается текущая архитектура проекта.